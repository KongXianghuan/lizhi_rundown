function Loader(t){this.resources={},this.resourcesLen=t.length,this.counter=0,this.timer={},this.init(t)}Loader.prototype={init:function(t){var e=this;e.setRes(t),e.fetch(e.resources),Loader.prototype=utils.mixin(Loader.prototype,Events.prototype)},setRes:function(t){var e=this;t.forEach(function(t,n){var r=e.getFileName(t),i=e.getFileExt(t),o=e.getNodeType(i),s={ext:i,type:o,path:t};e.resources[r]=s})},getFileName:function(t){return t.slice(t.lastIndexOf("/")+1).replace(/\?.*$/,"").toLowerCase()},getFileExt:function(t){return t.slice(t.lastIndexOf(".")+1,t.length).toLowerCase()},getNodeType:function(t){var e={img:["jpg","jpeg","gif","png","bmp"],audio:["ogg","wav","mp3","aac"]};for(var n in e)if(e[n].indexOf(t)>-1)return n},fetchImg:function(t){var e=this,n=new Image;n.style.display="none",n.onload=function(){e.count()},n.src=t},fetchAudio:function(t){var e=this,n=new Audio;n.preload="auto";var r=function(){return function(){n.readyState>0&&(clearInterval(e.timer[t]),e.timer[t]=null,e.count())}}();e.timer[t]=setInterval(r,100),n.src=t},fetch:function(t){for(var e in t)switch(t[e].type){case"img":this.fetchImg(t[e].path);break;case"audio":this.fetchAudio(t[e].path)}},count:function(){if(this.counter++,this.counter===this.resourcesLen)this.trigger("success");else{var t=parseInt(this.counter/this.resourcesLen*100);this.trigger("progress",t)}}};var Events=function(){};Events.prototype={constructor:Event,eventMap:{},trigger:function(t,e){this.eventMap[t]&&this.eventMap[t].forEach(function(t){t.call(this,e)})},on:function(t,e){this.eventMap[t]?this.eventMap[t].push(e):this.eventMap[t]=[e]}};var utils={mixin:function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}},loader=function(){return function(t){return new Loader(t)}}();